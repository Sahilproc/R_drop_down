library(shiny)
library(rpivotTable)

# Load data
data(iris)

# Define UI
ui <- fluidPage(
  titlePanel("Pivot Table Example"),
  sidebarLayout(
    sidebarPanel(
      selectInput("rows", "Select Rows:", choices = names(iris)),
      selectInput("cols", "Select Columns:", choices = names(iris)),
      selectInput("vals", "Select Values:", choices = names(iris), selected = "Sepal.Length"),
      selectInput("agg", "Select Aggregation:", choices = c("Sum", "Average"), selected = "Sum")
    ),
    mainPanel(
      rpivotTableOutput("pivot")
    )
  ),
  tabsetPanel(
    tabPanel("Pivot Table", rpivotTableOutput("pivot")),
    tabPanel("Table Data", tableOutput("table")),
    tabPanel("All Data", dataTableOutput("all_data"))
  )
)

# Define server
server <- function(input, output) {
  # Create pivot table
  output$pivot <- renderRpivotTable({
    rpivotTable(
      data = iris,
      rows = input$rows,
      cols = input$cols,
      aggregatorName = input$agg,
      vals = input$vals,
      output_type = "server"
    )
  })
  
  # Create table data
  output$table <- renderTable({
    iris
  })
  
  # Show all data
  output$all_data <- renderDataTable({
    iris
  })
}

# Run the app
shinyApp(ui, server).           # create a data frame with year and month columns
df <- data.frame(
  year = c(2021, 2021, 2021, 2022, 2022, 2022),
  month = c(1, 2, 3, 1, 2, 3),
  value = c(10, 20, 30, 40, 50, 60)
)

# get current year and month
current_year <- format(Sys.Date(), "%Y")
current_month <- format(Sys.Date(), "%m")

# filter data frame to last 6 months
last_six_months <- subset(df, 
                           (year == current_year & month >= as.numeric(current_month) - 5) | 
                           (year == as.numeric(current_year) - 1 & month >= as.numeric(current_month) + 7))

